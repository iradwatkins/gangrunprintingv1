**15\. Development: Product Configuration Form\*\***

This step implements the dynamic form on the Product Detail Page. It fetches all available options for the selected product (e.g., Paper Stocks, Print Sizes) from the database and presents them to the user as interactive form elements. This uses **\*\*React Hook Form\*\*** for state management, as specified in the technical guidelines. This work is the core of **\*\*Epic 2\*\***.

**\*\*Actions Taken:\*\***

1\.  **\*\*Create API Functions:\*\*** New functions are added to \`src/api/products.ts\` to fetch the specific options associated with a product by querying the many-to-many join tables (e.g., \`product\_paper\_stocks\`).  
2\.  **\*\*Integrate React Hook Form:\*\*** The \`useForm\` hook is initialized in the \`ProductDetailPage\` to manage the state of all configuration selections.  
3\.  **\*\*Build Form UI:\*\*** The page is updated to include form controls (like a \`Select\` dropdown) for each product option, linking them to the \`React Hook Form\` state.

Here is the code for the new API function to fetch associated paper stocks:

\`\`\`typescript  
// File: src/api/products.ts (add this new function)

import { supabase } from "@/lib/supabaseClient";

// ... (existing functions)

export const getPaperStocksForProduct \= async (productId: number) \=\> {  
  // This query joins through the 'product\_paper\_stocks' table  
  // to get all paper stocks linked to the given product ID.  
  const { data, error } \= await supabase  
    .from('product\_paper\_stocks') //  
    .select(\`  
      paper\_stocks (\*)  
    \`)  
    .eq('product\_id', productId);

  if (error) {  
    throw new Error(error.message);  
  }

  // The result is an array of { paper\_stocks: { ... } }, so we map it.  
  return data.map(item \=\> item.paper\_stocks);  
};  
\`\`\`

Here is the updated \`ProductDetailPage\` component, now with a configuration form:

\`\`\`typescript  
// File: src/pages/ProductDetailPage.tsx

import { useParams } from 'react-router-dom';  
import { useQuery } from '@tanstack/react-query';  
import { useForm, Controller } from 'react-hook-form'; //  
import { getProductBySlug, getPaperStocksForProduct } from '@/api/products';  
import { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';  
import { Button } from '@/components/ui/button';  
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';  
import { Label } from '@/components/ui/label';

// Define a type for our form data  
type ConfigurationFormData \= {  
  paperStock: string;  
  // Other options like printSize, coating, etc. will be added here  
};

export function ProductDetailPage() {  
  const { productSlug } \= useParams\<{ productSlug: string }\>();

  // Initialize React Hook Form  
  const { control, handleSubmit } \= useForm\<ConfigurationFormData\>();

  // Fetch the main product data  
  const { data: product, isLoading: isLoadingProduct } \= useQuery({  
    queryKey: \['product', productSlug\],  
    queryFn: () \=\> getProductBySlug(productSlug\!),  
    enabled: \!\!productSlug,  
  });

  // Fetch the paper stocks for this product once we have the product ID  
  const { data: paperStocks, isLoading: isLoadingPaperStocks } \= useQuery({  
    queryKey: \['paperStocks', product?.id\],  
    queryFn: () \=\> getPaperStocksForProduct(product\!.id),  
    enabled: \!\!product, // Only run this query if the product has been loaded  
  });

  const onSubmit \= (data: ConfigurationFormData) \=\> {  
    // This function will eventually handle adding the configured product to the cart  
    console.log('Form Submitted', data);  
  };

  if (isLoadingProduct) return \<div className="p-8"\>\<span\>Loading...\</span\>\</div\>;  
  if (\!product) return \<div className="p-8"\>\<span\>Product not found.\</span\>\</div\>;

  return (  
    \<div className="p-8 grid md:grid-cols-2 gap-8"\>  
      \<div\>  
        {/\* Placeholder for product image gallery \*/}  
        \<Card className="min-h-\[400px\]"\>  
          \<CardHeader\>\<CardTitle\>Image Gallery\</CardTitle\>\</CardHeader\>  
        \</Card\>  
      \</div\>  
        
      \<form onSubmit={handleSubmit(onSubmit)} className="space-y-6"\>  
        \<Card\>  
          \<CardHeader\>  
            \<CardTitle className="text-4xl"\>{product.name}\</CardTitle\>  
          \</CardHeader\>  
          \<CardContent\>  
            \<p\>{product.description}\</p\>  
          \</CardContent\>  
        \</Card\>

        \<Card\>  
          \<CardHeader\>\<CardTitle\>Configure Your Product\</CardTitle\>\</CardHeader\>  
          \<CardContent className="space-y-4"\>  
            {/\* Paper Stock Selector \*/}  
            {isLoadingPaperStocks ? (  
              \<span\>Loading options...\</span\>  
            ) : (  
              \<div\>  
                \<Label htmlFor="paper-stock"\>Paper Stock\</Label\>  
                \<Controller  
                  name="paperStock"  
                  control={control}  
                  render={({ field }) \=\> (  
                    \<Select onValueChange={field.onChange} defaultValue={field.value}\>  
                      \<SelectTrigger id="paper-stock"\>  
                        \<SelectValue placeholder="Select a paper stock" /\>  
                      \</SelectTrigger\>  
                      \<SelectContent\>  
                        {paperStocks?.map((stock: any) \=\> (  
                          \<SelectItem key={stock.id} value={stock.id.toString()}\>  
                            {stock.name}  
                          \</SelectItem\>  
                        ))}  
                      \</SelectContent\>  
                    \</Select\>  
                  )}  
                /\>  
              \</div\>  
            )}  
              
            {/\* Other option selectors (Print Size, Coating, etc.) will follow this same pattern \*/}

          \</CardContent\>  
        \</Card\>

        \<Button type="submit" size="lg" className="w-full"\>  
          Add to Cart  
        \</Button\>  
      \</form\>  
    \</div\>  
  );  
}  
\`\`\`  
