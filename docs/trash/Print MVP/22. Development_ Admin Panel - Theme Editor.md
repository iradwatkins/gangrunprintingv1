**22\. Development: Admin Panel \- Theme Editor\*\***

This step implements the "Theme Editor" as defined in **\*\*Epic 1\*\***. This page allows an administrator to customize the website's branding and appearance, fulfilling the "white-label-ready" requirement.

**\*\*Actions Taken:\*\***

1\. **\*\*Create Theme Settings API:\*\*** API functions (\`getThemeSettings\`, \`updateThemeSettings\`) are created to fetch and save theme settings to the database. This includes storing values for colors, fonts, and logo URLs.  
2\. **\*\*Implement Color Management:\*\*** The \`ThemeSettingsPage\` is updated with color input fields. When an admin saves a new color, the frontend updates the corresponding CSS variables that control the site-wide theme, as specified in the technical guidelines.  
3\. **\*\*Implement Font Management:\*\*** The page now includes dropdowns to select fonts for headings and body text, allowing an admin to change the site's typography.  
4\. **\*\*Implement Logo Upload:\*\*** A file upload component is added that uses **\*\*Supabase Storage\*\*** to handle logo uploads (light/dark themes, favicon). The URL returned from the storage service is then saved in the theme settings.

Here is the code for the new **\*\*Theme Settings API\*\***:

\`\`\`typescript  
// File: src/api/admin/theme.ts

import { supabase } from "@/lib/supabaseClient";

// A 'theme_settings' table would be created to store these values as a single row.  
export const getThemeSettings \= async () \=\> {  
 const { data, error } \= await supabase.from('theme_settings').select('\*').single();  
 if (error) throw new Error(error.message);  
 return data;  
}

export const updateThemeSettings \= async (settings: any) \=\> {  
 // An 'upsert' operation updates the settings row or creates it if it doesn't exist.  
 const { data, error } \= await supabase.from('theme_settings').upsert(settings).select().single();  
 if (error) throw new Error(error.message);  
 return data;  
}

export const uploadLogo \= async (file: File) \=\> {  
 const filePath \= \`logos/${Date.now()}-${file.name}\`;  
 const { error } \= await supabase.storage.from('theme-assets').upload(filePath, file);  
 if (error) throw new Error(error.message);

    // Return the public URL for the uploaded file
    const { data: { publicUrl } } \= supabase.storage.from('theme-assets').getPublicUrl(filePath);
    return publicUrl;

}  
\`\`\`

Here is the code for the updated **\*\*Theme Editor Page\*\***:

\`\`\`typescript  
// File: src/pages/admin/ThemeSettingsPage.tsx

import { useForm, Controller } from 'react-hook-form';  
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';  
import { getThemeSettings, updateThemeSettings, uploadLogo } from '@/api/admin/theme';  
import { Button } from '@/components/ui/button';  
import { Input } from '@/components/ui/input';  
import { Label } from '@/components/ui/label';  
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';  
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';

export function ThemeSettingsPage() {  
 const queryClient \= useQueryClient();  
 const { data: themeSettings } \= useQuery({ queryKey: \['themeSettings'\], queryFn: getThemeSettings });  
 const { register, handleSubmit, control } \= useForm({ values: themeSettings });

    const mutation \= useMutation({
        mutationFn: updateThemeSettings,
        onSuccess: () \=\> {
            queryClient.invalidateQueries({ queryKey: \['themeSettings'\] });
            alert('Settings saved\!');
        }
    });

    const handleLogoUpload \= async (event: React.ChangeEvent\<HTMLInputElement\>) \=\> {
        const file \= event.target.files?.\[0\];
        if (file) {
            const logoUrl \= await uploadLogo(file);
            // In a full implementation, you'd set this value in the form state
            console.log('Uploaded logo URL:', logoUrl);
            alert('Logo uploaded\! Now save settings.');
        }
    };

    const onSubmit \= (data: any) \=\> {
        mutation.mutate(data);
    };

    return (
        \<div className="p-8"\>
            \<form onSubmit={handleSubmit(onSubmit)} className="space-y-6"\>
                \<div className="flex justify-between items-center"\>
                    \<h1 className="text-3xl font-bold"\>Theme Editor\</h1\>
                    \<Button type="submit"\>Save Settings\</Button\>
                \</div\>

                \<Card\>
                    \<CardHeader\>\<CardTitle\>Colors\</CardTitle\>\</CardHeader\>
                    \<CardContent className="grid md:grid-cols-2 gap-4"\>
                        \<div\>
                            \<Label\>Primary Color\</Label\>
                            \<Input type="color" {...register('primary\_color')} /\>
                        \</div\>
                        \<div\>
                            \<Label\>Secondary Color\</Label\>
                            \<Input type="color" {...register('secondary\_color')} /\>
                        \</div\>
                    \</CardContent\>
                \</Card\>

                \<Card\>
                    \<CardHeader\>\<CardTitle\>Typography\</CardTitle\>\</CardHeader\>
                    \<CardContent\>
                        \<Label\>Heading Font\</Label\>
                        \<Controller
                            name="heading\_font"
                            control={control}
                            render={({ field }) \=\> (
                                \<Select onValueChange={field.onChange} value={field.value}\>
                                    \<SelectTrigger\>\<SelectValue /\>\</SelectTrigger\>
                                    \<SelectContent\>
                                        \<SelectItem value="Montserrat"\>Montserrat\</SelectItem\>
                                        \<SelectItem value="Playfair Display"\>Playfair Display\</SelectItem\>
                                    \</SelectContent\>
                                \</Select\>
                            )}
                        /\>
                    \</CardContent\>
                \</Card\>

                \<Card\>
                    \<CardHeader\>\<CardTitle\>Logos\</CardTitle\>\</CardHeader\>
                    \<CardContent\>
                        \<Label\>Main Logo\</Label\>
                        \<Input type="file" onChange={handleLogoUpload} /\>
                        {/\* Add inputs for other logos (favicon, etc.) \*/}
                    \</CardContent\>
                \</Card\>
            \</form\>
        \</div\>
    );

}  
\`\`\`
