**11\. Development: Backend Database Schema Setup\*\***

This step involves creating the PostgreSQL database tables in Supabase. The schema is implemented exactly as defined in the \`System-Architecture.md\` document, which provides the blueprint for our data structure. This action aligns with our selection of Supabase as the primary BaaS.

**\*\*Actions Taken:\*\***

1\. **\*\*Connect to Database:\*\*** A connection is established to the Supabase PostgreSQL instance.  
2\. **\*\*Execute Schema SQL:\*\*** The \`CREATE TABLE\` SQL statements are executed to build the database structure.

Here are the SQL statements for some of the key tables to illustrate the process:

**\*\*Products Table:\*\*** This table stores the core product information.

\`\`\`sql  
\-- File: supabase/migrations/001_create_products_table.sql

CREATE TABLE products (  
 id BIGINT PRIMARY KEY GENERATED ALWAYS AS IDENTITY,  
 created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),  
 updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),

    \-- Foreign key linking to the product\_categories table
    category\_id BIGINT REFERENCES product\_categories(id) NOT NULL, \--

    \-- Foreign key linking to the vendors table
    vendor\_id BIGINT REFERENCES vendors(id), \--

    name TEXT NOT NULL,
    slug TEXT NOT NULL UNIQUE,
    description TEXT,
    base\_price DECIMAL(10, 2\) NOT NULL DEFAULT 0.00

);  
\`\`\`

**\*\*Add-ons Table:\*\*** This table uses flexible data types (\`ENUM\` and \`JSONB\`) to handle diverse add-on types and their unique pricing rules.

\`\`\`sql  
\-- File: supabase/migrations/002_create_addons_table.sql

\-- Define a custom type for the pricing model  
CREATE TYPE addon_pricing_model AS ENUM ('fixed', 'per_unit', 'percentage'); \--

CREATE TABLE add_ons (  
 id BIGINT PRIMARY KEY GENERATED ALWAYS AS IDENTITY,  
 created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),  
 updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),

    name TEXT NOT NULL,
    description TEXT,

    \-- Defines which calculation model to use for this add-on
    pricing\_model addon\_pricing\_model NOT NULL, \--

    \-- A flexible JSONB field to store configuration specific to the pricing model
    \-- e.g., { "amount": 5.00 } for fixed, or { "rate": 0.10 } for percentage
    configuration JSONB NOT NULL DEFAULT '{}'::jsonb \--

);  
\`\`\`

**\*\*Order Jobs Table:\*\*** This table stores the individual line items for an order. It includes a \`JSONB\` snapshot of the product's full configuration at the time of purchase to ensure historical accuracy.

\`\`\`sql  
\-- File: supabase/migrations/003_create_order_jobs_table.sql

CREATE TABLE order_jobs (  
 id BIGINT PRIMARY KEY GENERATED ALWAYS AS IDENTITY,  
 created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),  
 updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),

    \-- Foreign key linking to the parent orders table
    order\_id BIGINT REFERENCES orders(id) ON DELETE CASCADE NOT NULL, \--

    \-- Foreign key linking to the product that was ordered
    product\_id BIGINT REFERENCES products(id) NOT NULL, \--

    \-- JSONB snapshot of the full product configuration at time of purchase
    configuration JSONB NOT NULL, \--

    \-- JSONB snapshot of the price breakdown for this specific job
    price\_summary JSONB NOT NULL, \--

    quantity INT NOT NULL CHECK (quantity \> 0),
    job\_status TEXT NOT NULL DEFAULT 'Pending',
    tracking\_number TEXT

);  
\`\`\`
