**25\. Development: Automated Order Fulfillment (n8n.io)\*\***

This step implements the automated order fulfillment workflow, the final major feature of the MVP as defined in **\*\*Epic 7\*\***. This system will automatically send new order details to the appropriate external print vendors using n8n.io, as required by the Project Brief.

**\*\*Actions Taken:\*\***

1\.  **\*\*Create Database Webhook:\*\*** A **\*\*Supabase Database Webhook\*\*** is configured. This webhook listens for any new \`INSERT\` operations on the \`orders\` table. When a new order is successfully created, the webhook automatically triggers.  
2\.  **\*\*Configure n8n.io Workflow:\*\*** An automation workflow is set up in n8n.io.  
    \* **\*\*Trigger:\*\*** The workflow starts with a "Webhook" node, which provides a unique URL. This URL is used as the destination for the Supabase webhook.  
    \* **\*\*Action:\*\*** The workflow will parse the incoming order data, format it into a clear and readable email, and send it to the appropriate vendor. The vendor's email address is retrieved based on the products in the order.  
3\.  **\*\*Design Webhook Payload:\*\*** The Supabase webhook is configured to send a detailed JSON payload containing all the necessary information for the vendor to fulfill the order.

Here is the SQL to create the **\*\*Supabase Database Webhook\*\***:

\`\`\`sql  
\-- This SQL sets up the trigger and function to call the n8n.io webhook.

\-- 1\. Create a function that will be called by the trigger  
create or replace function notify\_n8n\_on\_new\_order()  
returns trigger  
language plpgsql  
as $$  
begin  
  \-- Perform a POST request to the n8n webhook URL  
  perform http\_post(  
    '\[https://your-n8n-webhook-url.com/webhook/new-order\](https://your-n8n-webhook-url.com/webhook/new-order)', \-- The n8n Webhook URL  
    json\_build\_object('record', new), \-- 'new' refers to the newly inserted order row  
    '{}'::http\_header\[\]  
  );  
  return new;  
end;  
$$;

\-- 2\. Create a trigger that calls the function after a new order is inserted  
create trigger new\_order\_trigger  
after insert on orders  
for each row  
execute function notify\_n8n\_on\_new\_order();  
\`\`\`

Here is an example of the **\*\*JSON payload\*\*** that the webhook will send to n8n.io:

\`\`\`json  
{  
  "record": {  
    "id": 101,  
    "created\_at": "2025-06-20T22:30:00Z",  
    "customer\_id": "user-uuid-12345",  
    "reference\_number": "GRP-00101",  
    "status": "Pending",  
    "shipping\_address": {  
      "fullName": "John Doe",  
      "streetAddress": "123 Main St",  
      "city": "Anytown",  
      "state": "CA",  
      "zipCode": "12345"  
    },  
    // The full order jobs details would be fetched in the n8n workflow  
    // or included in a more complex payload.  
  }  
}  
\`\`\`

This completes the implementation of all major epics defined for the MVP. The platform now supports product configuration, ordering, user accounts, administrative management, marketing tools, and automated fulfillment.  
