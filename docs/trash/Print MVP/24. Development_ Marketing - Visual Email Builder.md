**24\. Development: Marketing \- Visual Email Builder\*\***

This step implements the visual email builder, a cornerstone of **\*\*Epic 6\*\***. This feature allows administrators to create responsive, branded emails for marketing campaigns, as required by the Project Brief.

**\*\*Actions Taken:\*\***

1\.  **\*\*Integrate Email Framework:\*\*** A modern email framework like **\*\*React Email\*\*** is integrated into the project. This allows for creating beautiful, responsive email templates using React components.  
2\.  **\*\*Create Email Templates Table:\*\*** A new \`email\_templates\` table is created in the database to store the saved email designs, including their name, subject, and the generated HTML content.  
3\.  **\*\*Create Save Template API:\*\*** An API function, \`saveEmailTemplate\`, is created. It takes the HTML content generated by the email builder and saves it to the \`email\_templates\` table.  
4\.  **\*\*Build Email Builder Page:\*\*** A new \`AdminEmailBuilderPage.tsx\` component is built. This page will host the editor interface, allowing an admin to compose an email, preview it, and save the template.

Here is the SQL for the new **\*\*Email Templates Table\*\***:

\`\`\`sql  
\-- File: supabase/migrations/005\_create\_email\_templates\_table.sql

CREATE TABLE email\_templates (  
    id BIGINT PRIMARY KEY GENERATED ALWAYS AS IDENTITY,  
    created\_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),  
    updated\_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),  
      
    name TEXT NOT NULL,  
    subject TEXT NOT NULL,  
      
    \-- Stores the full HTML content of the email  
    html\_content TEXT NOT NULL  
);  
\`\`\`

Here is the code for the new **\*\*Email API function\*\***:

\`\`\`typescript  
// File: src/api/admin/email.ts

import { supabase } from "@/lib/supabaseClient";

export const saveEmailTemplate \= async ({ name, subject, htmlContent }: { name: string, subject: string, htmlContent: string }) \=\> {  
    const { data, error } \= await supabase  
        .from('email\_templates')  
        .insert({ name, subject, html\_content: htmlContent })  
        .select()  
        .single();  
          
    if (error) throw new Error(error.message);  
    return data;  
}  
\`\`\`

Here is a simplified concept for the **\*\*Admin Email Builder Page\*\***:

\`\`\`typescript  
// File: src/pages/admin/AdminEmailBuilderPage.tsx

import { useState } from 'react';  
import { useMutation } from '@tanstack/react-query';  
import { saveEmailTemplate } from '@/api/admin/email';  
import { Button } from '@/components/ui/button';  
import { Input } from '@/components/ui/input';  
import { Label } from '@/components/ui/label';  
import { Textarea } from '@/components/ui/textarea';

// In a real implementation, this component would use a library like React Email  
// to provide a rich, drag-and-drop editing experience. This is a simplified representation.

export function AdminEmailBuilderPage() {  
    const \[name, setName\] \= useState('');  
    const \[subject, setSubject\] \= useState('');  
    const \[htmlContent, setHtmlContent\] \= useState('\<h1\>Your Email Title\</h1\>\<p\>Start editing...\</p\>');

    const saveMutation \= useMutation({  
        mutationFn: saveEmailTemplate,  
        onSuccess: () \=\> {  
            alert('Template saved successfully\!');  
        },  
        onError: (error) \=\> {  
            alert(\`Error: ${error.message}\`);  
        }  
    });

    const handleSave \= () \=\> {  
        saveMutation.mutate({ name, subject, htmlContent });  
    };

    return (  
        \<div className="p-8 grid md:grid-cols-2 gap-8 h-full"\>  
            \<section className="flex flex-col space-y-4"\>  
                \<h1 className="text-3xl font-bold"\>Email Builder\</h1\>  
                \<div\>  
                    \<Label\>Template Name\</Label\>  
                    \<Input value={name} onChange={(e) \=\> setName(e.target.value)} placeholder="e.g., Welcome Email" /\>  
                \</div\>  
                \<div\>  
                    \<Label\>Email Subject\</Label\>  
                    \<Input value={subject} onChange={(e) \=\> setSubject(e.target.value)} placeholder="e.g., Welcome to our newsletter\!" /\>  
                \</div\>  
                \<div\>  
                    \<Label\>Email Body (HTML)\</Label\>  
                    \<Textarea   
                        value={htmlContent}   
                        onChange={(e) \=\> setHtmlContent(e.target.value)}  
                        className="h-96 font-mono"  
                    /\>  
                \</div\>  
                \<Button onClick={handleSave} disabled={saveMutation.isPending}\>  
                    {saveMutation.isPending ? 'Saving...' : 'Save Template'}  
                \</Button\>  
            \</section\>  
              
            \<section\>  
                \<h2 className="text-2xl font-bold mb-4"\>Live Preview\</h2\>  
                \<div className="border rounded-lg p-4 bg-white h-full"\>  
                    \<iframe  
                        srcDoc={htmlContent}  
                        title="Email Preview"  
                        className="w-full h-full border-none"  
                    /\>  
                \</div\>  
            \</section\>  
        \</div\>  
    );  
}  
\`\`\`  
