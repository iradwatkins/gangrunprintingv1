**14\. Development: Dynamic Product Detail Page\*\***

This step focuses on building the dynamic product detail page. This page will fetch and display information for a single product based on which one the user selects from the main products list. This is a core part of **\*\*Epic 2: Product Catalog & Configuration\*\***.

**\*\*Actions Taken:\*\***

1\.  **\*\*Create API Function:\*\*** A new function, \`getProductBySlug\`, is added to \`src/api/products.ts\`. This function retrieves a single product from the Supabase database using its unique \`slug\`.  
2\.  **\*\*Use Dynamic Route Parameter:\*\*** The \`ProductDetailPage\` component now uses the \`useParams\` hook from **\*\*React Router DOM\*\*** to get the \`productSlug\` from the URL.  
3\.  **\*\*Fetch Single Product Data:\*\*** \`useQuery\` is used with a dynamic key (\`\['product', productSlug\]\`) to ensure React Query fetches and caches each product's data individually.

Here is the code for the new data fetching function:

\`\`\`typescript  
// File: src/api/products.ts (add this new function)

import { supabase } from "@/lib/supabaseClient";

// ... (existing getProducts function)

export const getProductBySlug \= async (slug: string) \=\> {  
  // Fetch a single product from the 'products' table where the slug matches  
  const { data, error } \= await supabase  
    .from('products') //  
    .select('\*')  
    .eq('slug', slug) //  
    .single(); // .single() ensures we get one record or null

  if (error) {  
    throw new Error(error.message);  
  }

  return data;  
};  
\`\`\`

Here is the code for the updated page component that displays the single product's details:

\`\`\`typescript  
// File: src/pages/ProductDetailPage.tsx

import { useParams } from 'react-router-dom';  
import { useQuery } from '@tanstack/react-query';  
import { getProductBySlug } from '@/api/products';  
import { Card, CardHeader, CardTitle, CardDescription, CardContent } from '@/components/ui/card';

export function ProductDetailPage() {  
  const { productSlug } \= useParams\<{ productSlug: string }\>();

  const { data: product, isLoading, isError, error } \= useQuery({  
    // The query key is an array; the second element is the dynamic slug.  
    // React Query will re-fetch if this slug changes.  
    queryKey: \['product', productSlug\],  
    queryFn: () \=\> getProductBySlug(productSlug\!),  
    enabled: \!\!productSlug, // Ensures the query only runs if productSlug is available  
  });

  if (isLoading) {  
    return \<div className="p-8"\>\<span\>Loading product details...\</span\>\</div\>;  
  }

  if (isError) {  
    return \<div className="p-8"\>\<span\>Error: {error.message}\</span\>\</div\>;  
  }

  if (\!product) {  
    return \<div className="p-8"\>\<span\>Product not found.\</span\>\</div\>;  
  }

  return (  
    \<div className="p-8"\>  
      \<Card\>  
        \<CardHeader\>  
          \<CardTitle className="text-4xl"\>{product.name}\</CardTitle\>  
          \<CardDescription\>Base Price: ${product.base\_price}\</CardDescription\>  
        \</CardHeader\>  
        \<CardContent\>  
          \<p\>{product.description}\</p\>  
          {/\* The dynamic configuration form will be added here in the next step \*/}  
        \</CardContent\>  
      \</Card\>  
    \</div\>  
  );  
}  
\`\`\`  
